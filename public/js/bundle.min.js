(function(){
'use strict';var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Number.isFinite",function(a){return a?a:function(a){return"number"!==typeof a?!1:!isNaN(a)&&Infinity!==a&&-Infinity!==a}},"es6","es3");
$jscomp.polyfill("Number.isInteger",function(a){return a?a:function(a){return Number.isFinite(a)?a===Math.floor(a):!1}},"es6","es3");var Client={};
(function(){Client.connectToServer=function(){Client.socket=io.connect();Client.socket.on("disconnect",function(){game.state.start("MainMenuState")});Client.socket.on("playerUpdate",function(a){gameplayState.movePlayer(a.id,a.x,a.y,a.d)});Client.socket.on("playerEvent",function(a){a.disconnectTime?gameplayState.removePlayer(a.playerId):gameplayState.addNewPlayer(a.playerId,a.x,a.y)});Client.socket.on("initWorld",function(a){for(var b=a.players.split("|"),c=0;c<b.length-1;c++){var d=b[c].split(" "),
e=parseInt(d[0]),f=parseFloat(d[1]),g=parseFloat(d[2]);parseInt(d[3]);gameplayState.addNewPlayer(e,f,g)}a.id&&gameplayState.setPlayerReference(a.id);b=a.tiles.split(" ");c=parseInt(b[0]);d=parseInt(b[1]);e=2;f=[];for(g=0;g<c;g++){f[g]=[];for(var h=0;h<d;h++)f[g][h]=parseInt(b[e++])}gameplayState.generateTiles(f);b=a.trees.split("|");for(c=0;c<b.length-1;c++)f=b[c].split(" "),d=parseInt(f[0]),e=parseInt(f[1]),f=parseInt(f[2]),gameplayState.placeSolidObject(0,d,e,f);b=a.chests.split("|");c=[];for(d=
0;d<b.length-1;d++)h=b[d].split(" "),e=parseInt(h[0]),f=parseInt(h[1]),g=parseInt(h[2]),h=parseInt(h[3]),c.push({x:e,y:f,playerRequired:h,state:g});gameplayState.spawnTreasureChests(c);gameplayState.startWeatherEffect(a.weather)});Client.socket.on("update",function(a){a.forEach(function(a){a=a.d.split("|");for(var b=0;b<a.length-1;b++){var d=a[b].split(" "),e=parseInt(d[0]),f=parseFloat(d[1]),g=parseFloat(d[2]);d=parseInt(d[3]);gameplayState.updatePlayerPos(e,f,g,d)}})});Client.socket.on("worldUpdate",
function(a){for(var b=0;b<a.tiles.length;b++){var c=a.tiles[b];gameplayState.changeTileAt(c[0],c[1],c[2])}});Client.socket.on("playSound",function(a){gameplayState.playAbstractSoundFrom(a.id)});Client.socket.on("chestUpdate",function(a){gameplayState.interactWithChest(a.x,a.y,a.state,a.playerRequired,a.success)});Client.socket.on("objectUpdate",function(a){console.log("New trees are spawned..");a.forEach(function(a){gameplayState.placeSolidObject(0,a.x,a.y,a.durability)})});Client.socket.on("objectRemoval",
function(a){gameplayState.deleteObjectAt(a.x,a.y)});Client.socket.on("inventoryUpdate",function(a){gameplayState.updatePlayerInventory(a.id,a.inventory)});Client.socket.on("errorSound",function(a){gameplayState.playErrorSound(a.id)});Client.socket.on("treeCut",function(a){gameplayState.cutTree(a.x,a.y,a.durability)});Client.socket.on("weatherChange",function(a){gameplayState.startWeatherEffect(a)});Client.socket.on("spawnChests",function(a){gameplayState.spawnTreasureChests(a)})};Client.disconnectFromServer=
function(){Client.socket.disconnect()};Client.askNewPlayer=function(){Client.socket.emit("newplayer");console.log("newPlayer")};Client.sendInputs=function(a){0!==a&&Client.socket.emit("inputCommand",{type:1,params:a})};Client.changeTile=function(a,b){Client.socket.emit("inputCommand",{type:2,params:{tileId:a}})};Client.interact=function(){Client.socket.emit("inputCommand",{type:4})};Client.playSound=function(){Client.socket.emit("inputCommand",{type:3})}})();var ControlsState=function(a){};ControlsState.prototype={preload:function(){},create:function(){this.controlsUI=new ControlsUI(game,0,0);this.returnText=game.add.bitmapText(GAME_WIDTH/2,430,"m5x7","======Press Esc to go back======",48);this.returnText.anchor.setTo(.5);this.returnText.tint=12545866;this.blipHigh=game.add.audio("blipHigh");this.blipHigh.volume=.25},update:function(){game.input.keyboard.justPressed(Phaser.Keyboard.ESC)&&(this.blipHigh.play(),game.state.start("MainMenuState"))}};function ControlsUI(a,b,c){this.game=a;this.x=b||0;this.y=c||0;this.screenShader=a.add.sprite(0,0,"screenShader");this.screenShader.scale.x=a.world.width;this.screenShader.scale.y=a.world.height;this.screenShader.tint=16173727;this.textColor=12545866;this.offsetY=110;this.marginY=60;this.titleText=a.add.bitmapText(b+GAME_WIDTH/2,c+this.offsetY/3*2,"m5x7","============CONTROLS============",48);this.titleText.anchor.setTo(.5);this.movementText=a.add.bitmapText(b+GAME_WIDTH/2+56,c+this.offsetY+this.marginY-
12,"m5x7","- move",48);this.movementText.anchor.setTo(.5);this.interactText=a.add.bitmapText(b+GAME_WIDTH/2+18,c+this.offsetY+2*this.marginY,"m5x7","- open chests/cut down trees",48);this.interactText.anchor.setTo(.5);this.placeText=a.add.bitmapText(b+GAME_WIDTH/2+36,c+this.offsetY+3*this.marginY,"m5x7","- place tiles",48);this.placeText.anchor.setTo(.5);this.makeSoundText=a.add.bitmapText(b+GAME_WIDTH/2+18,c+this.offsetY+4*this.marginY,"m5x7","- make a sound",48);this.makeSoundText.anchor.setTo(.5);
this.zIcon=a.add.sprite(this.interactText.x-this.interactText.width/2-51,this.interactText.y-this.interactText.height+4,"zIcon");this.spaceIcon=a.add.sprite(this.placeText.x-this.placeText.width/2-112,this.placeText.y-this.placeText.height+4,"spaceIcon");this.arrowKeysIcon=a.add.sprite(this.movementText.x-this.movementText.width/2-124,this.movementText.y-this.movementText.height-32,"arrowKeysIcon");this.eIcon=a.add.sprite(this.makeSoundText.x-this.makeSoundText.width/2-52,this.makeSoundText.y-this.makeSoundText.height,
"eIcon");this.titleText.tint=this.textColor;this.movementText.tint=this.textColor;this.interactText.tint=this.textColor;this.placeText.tint=this.textColor;this.makeSoundText.tint=this.textColor}ControlsUI.prototype.destroy=function(){this.screenShader.destroy();this.titleText.destroy();this.movementText.destroy();this.interactText.destroy();this.placeText.destroy();this.makeSoundText.destroy();this.zIcon.destroy();this.eIcon.destroy();this.spaceIcon.destroy();this.arrowKeysIcon.destroy()};var WORLD_WIDTH=88,WORLD_HEIGHT=88,GameplayState=function(a){this.playerMap={};this.player=null;this.objectMap=[];for(a=0;a<WORLD_HEIGHT;a++)this.objectMap[a]=[];this.weatherEffects=[];this.isRainOn=!1},playerSpeed=32,tileName="Grass Sand Stone Water Bridge Forest Snow Desert Ice Cobblestone".split(" "),FACING_LEFT=4,FACING_UP=8,FACING_DOWN=2,FACING_RIGHT=6,MIN_HEARING_DISTANCE=600,TILE_SIZE=32;
GameplayState.prototype={init:function(){Client.connectToServer()},preload:function(){},create:function(){this.createSoundObjects();game.world.setBounds(0,0,WORLD_WIDTH*TILE_SIZE,WORLD_HEIGHT*TILE_SIZE);this.tileGroup=game.add.group();this.tileMap=game.add.tilemap();this.tileMap.setTileSize(TILE_SIZE,TILE_SIZE);this.tileMap.addTilesetImage("gameTileset");this.mainLayer=this.tileMap.create("mainLayer",WORLD_WIDTH,WORLD_HEIGHT,TILE_SIZE,TILE_SIZE);this.tileChoice=0;game.input.keyboard.onDownCallback=
this.handleKeys;this.solidObjectsGroup=game.add.group();this.playersGroup=game.add.group();this.playerIconsGroup=game.add.group();this.treasureUIGroup=game.add.group();this.uiGroup=game.add.group();this.uiGroup.fixedToCamera=!0;this.initializeWeatherEffects();this.pauseUI=new PauseUI(game,0,0);this.uiGroup.add(this.pauseUI.pauseBackground);this.uiGroup.add(this.pauseUI.promptText);this.uiGroup.add(this.pauseUI.choiceText);this.pauseUI.hide();this.escIcon=game.add.sprite(4,4,"escIcon");this.uiGroup.add(this.escIcon);
this.playerInventoryUI=new InventoryUI(game,120,393,"inventoryUI");this.uiGroup.add(this.playerInventoryUI);for(var a=0;a<this.playerInventoryUI.itemsText.length;a++)this.uiGroup.add(this.playerInventoryUI.itemsText[a]);this.uiGroup.add(this.playerInventoryUI.highlightUI);for(a=0;a<this.playerInventoryUI.itemsText.length;a++)this.uiGroup.add(this.playerInventoryUI.numbersText[a]);this.tileText=game.add.bitmapText(320,450,"m5x7",tileName[this.tileChoice],48);this.tileText.anchor.x=.5;this.uiGroup.add(this.tileText);
this.controlsUI=new ControlsUI(game,0,0);this.loadingText=game.add.bitmapText(GAME_WIDTH/2,430,"m5x7","Loading...",48);this.loadingText.anchor.setTo(.5);this.loadingText.tint=12545866;this.cursors=game.input.keyboard.createCursorKeys()},shutdown:function(){Client.disconnectFromServer()},updateInput:function(){var a=0,b=0;this.cursors.up.isDown&&b--;this.cursors.down.isDown&&b++;this.cursors.left.isDown&&a--;this.cursors.right.isDown&&a++;0!==a&&0!==b?"x"===this._preferredAxis?b=0:a=0:0!==a?this._preferredAxis=
"y":0!==b&&(this._preferredAxis="x");var c=0;if(0!==a||0!==b)c=5-3*b+a;this.player&&this.player.canMove&&Client.sendInputs(c)},update:function(){this.updateInput();this.pauseUI.paused?(game.input.keyboard.justPressed(Phaser.Keyboard.ESC)&&this.pauseUI.hide(),game.input.keyboard.justPressed(Phaser.Keyboard.Y)&&(this.stopAllSounds(),game.state.start("MainMenuState"))):game.input.keyboard.justPressed(Phaser.Keyboard.ESC)&&this.pauseUI.show()},initializeWeatherEffects:function(){this.screenShader=game.add.sprite(0,
0,"screenShader");this.screenShader.scale.x=game.world.width;this.screenShader.scale.y=game.world.height;this.screenShader.tint=7829367;this.screenShader.alpha=0;this.weatherEffects[0]=this.screenShader;this.rainEmitter=game.add.emitter(game.world.centerX,0,256);this.rainEmitter.fixedToCamera=!0;this.rainEmitter.makeParticles(["raindrop"],0,256);this.rainEmitter.gravity=0;this.rainEmitter.setRotation(0,0);this.rainEmitter.setXSpeed(-128,-128);this.rainEmitter.setYSpeed(512,512);this.rainEmitter.setScale(2,
2,2,2);this.rainEmitter.setAlpha(.3,.7);var a=new Phaser.Rectangle(game.world.centerX,0,game.world.width,1);this.rainEmitter.area=a;this.weatherEffects[1]=this.rainEmitter;this.rainEmitter.start(!1,2E3,10);this.rainEmitter.on=!1;this.snowEmitter=game.add.emitter(game.world.centerX,0,512);this.snowEmitter.fixedToCamera=!0;this.snowEmitter.makeParticles("snowflakes",[0,1,2],400);this.snowEmitter.gravity=0;this.snowEmitter.setXSpeed(-20,-20);this.snowEmitter.setYSpeed(96,96);this.snowEmitter.minParticleScale=
.5;this.snowEmitter.maxParticleScale=1.5;this.snowEmitter.setAlpha(.5,.9);this.snowEmitter.area=a;this.weatherEffects[2]=this.snowEmitter;this.snowEmitter.start(!1,1E4,64);this.snowEmitter.on=!1},startWeatherEffect:function(a){0===a?(this.stopRainEffect(),this.stopSnowEffect()):1===a?(this.stopSnowEffect(),this.startRainEffect()):2===a?(this.stopRainEffect(),this.startSnowEffect()):3===a&&(this.startRainEffect(),this.startSnowEffect())},startRainEffect:function(){this.lightRainSound.isPlaying||this.lightRainSound.play();
this.screenShader.tint=10066329;game.add.tween(this.screenShader).to({alpha:.4},1500,"Linear",!0);this.rainEmitter.on=!0},stopRainEffect:function(){this.lightRainSound.isPlaying&&this.lightRainSound.stop();game.add.tween(this.screenShader).to({alpha:0},1500,"Linear",!0);this.rainEmitter.on=!1},startSnowEffect:function(){this.screenShader.tint=16777215;game.add.tween(this.screenShader).to({alpha:.3},1500,"Linear",!0);this.snowEmitter.on=!0},stopSnowEffect:function(){game.add.tween(this.screenShader).to({alpha:0},
1500,"Linear",!0);this.snowEmitter.on=!1},createSoundObjects:function(){this.placeTileSound=game.add.audio("placeTileSound");this.errorSound=game.add.audio("errorSound");this.errorSound.volume=.2;this.abstractSound=game.add.audio("abstractSound");this.pickupLootSound=game.add.audio("pickupLootSound");this.chestOpenSound=game.add.audio("chestOpenSound");this.chestUnlockSound=game.add.audio("chestUnlockSound");this.chestLockedSound=game.add.audio("chestLockedSound");this.treeCutSound=game.add.audio("treeCutSound");
this.treeDestroyedSound=game.add.audio("treeDestroyedSound");this.grassSound=game.add.audio("grassFootsteps");this.sandSound=game.add.audio("sandFootsteps");this.stoneSound=game.add.audio("stoneFootsteps");this.lightRainSound=game.add.audio("lightRain",1,!0);this.tileSounds=[this.grassSound,this.sandSound,this.stoneSound]},stopAllSounds:function(){this.lightRainSound.isPlaying&&this.lightRainSound.stop()},addNewPlayer:function(a,b,c){this.playerMap[a]=new Player(game,Math.floor(b*TILE_SIZE),Math.floor(c*
TILE_SIZE),"player");this.playersGroup.add(this.playerMap[a]);if(this.player){this.player.bringToTop();for(a=0;a<this.weatherEffects.length;a++)game.world.bringToTop(this.weatherEffects[a]);this.uiGroup&&game.world.bringToTop(this.uiGroup)}},setPlayerReference:function(a){this.player=this.playerMap[a];this.player.enableArrowIcon();game.camera.follow(this.player,Phaser.Camera.FOLLOW_TOPDOWN);this.player.bringToTop();for(a=0;a<this.weatherEffects.length;a++)game.world.bringToTop(this.weatherEffects[a]);
this.uiGroup&&game.world.bringToTop(this.uiGroup)},removePlayer:function(a){this.playerMap[a].destroy();delete this.playerMap[a]},handleKeys:function(a){a.keyCode===Phaser.Keyboard.ONE&&(gameplayState.tileChoice=0,gameplayState.tileText.text=tileName[gameplayState.tileChoice],gameplayState.playerInventoryUI.updateHighlight(gameplayState.tileChoice));a.keyCode===Phaser.Keyboard.TWO&&(gameplayState.tileChoice=1,gameplayState.tileText.text=tileName[gameplayState.tileChoice],gameplayState.playerInventoryUI.updateHighlight(gameplayState.tileChoice));
a.keyCode===Phaser.Keyboard.THREE&&(gameplayState.tileChoice=2,gameplayState.tileText.text=tileName[gameplayState.tileChoice],gameplayState.playerInventoryUI.updateHighlight(gameplayState.tileChoice));a.keyCode===Phaser.Keyboard.FOUR&&(gameplayState.tileChoice=4,gameplayState.tileText.text=tileName[gameplayState.tileChoice],gameplayState.playerInventoryUI.updateHighlight(gameplayState.tileChoice-1));a.keyCode===Phaser.Keyboard.FIVE&&(gameplayState.tileChoice=5,gameplayState.tileText.text=tileName[gameplayState.tileChoice],
gameplayState.playerInventoryUI.updateHighlight(gameplayState.tileChoice-1));a.keyCode===Phaser.Keyboard.SIX&&(gameplayState.tileChoice=6,gameplayState.tileText.text=tileName[gameplayState.tileChoice],gameplayState.playerInventoryUI.updateHighlight(gameplayState.tileChoice-1));a.keyCode===Phaser.Keyboard.SEVEN&&(gameplayState.tileChoice=7,gameplayState.tileText.text=tileName[gameplayState.tileChoice],gameplayState.playerInventoryUI.updateHighlight(gameplayState.tileChoice-1));a.keyCode===Phaser.Keyboard.EIGHT&&
(gameplayState.tileChoice=8,gameplayState.tileText.text=tileName[gameplayState.tileChoice],gameplayState.playerInventoryUI.updateHighlight(gameplayState.tileChoice-1));a.keyCode===Phaser.Keyboard.NINE&&(gameplayState.tileChoice=9,gameplayState.tileText.text=tileName[gameplayState.tileChoice],gameplayState.playerInventoryUI.updateHighlight(gameplayState.tileChoice-1));a.keyCode===Phaser.Keyboard.SPACEBAR&&Client.changeTile(gameplayState.tileChoice,gameplayState.player.facing);a.keyCode===Phaser.Keyboard.Z&&
Client.interact();a.keyCode===Phaser.Keyboard.E&&Client.playSound()},updatePlayerInventory:function(a,b){this.playerMap[a]===this.player&&this.playerInventoryUI.updateDisplay(b)},playAbstractSoundFrom:function(a){a=this.playerMap[a];a.canMakeSound&&(this.playSoundFrom(this.abstractSound,a.x,a.y,1),a.startSoundTimer())},playErrorSound:function(a){this.playerMap[a]===this.player&&this.errorSound.play()},updatePlayerPos:function(a,b,c,d){a=this.playerMap[a];var e=Math.floor(b*TILE_SIZE),f=Math.floor(c*
TILE_SIZE);a.updateIconPositions(e,f);a.canMove=Number.isInteger(b)&&Number.isInteger(c);a.x=e;a.y=f;a.setDirection(d)},movePlayer:function(a,b,c,d){},changeTileAt:function(a,b,c){0>a||a>=this.tileMap.width||0>b||b>=this.tileMap.height?console.log("invalid tile position"):(this.playSoundFrom(this.placeTileSound,a*TILE_SIZE,b*TILE_SIZE,.15),this.tileMap.putTile(c,a,b))},generateTiles:function(a){for(var b=0;b<a.length;b++)for(var c=0;c<a[b].length;c++)this.tileMap.putTile(a[b][c],b,c);this.controlsUI.destroy();
this.loadingText.destroy()},generateSolidObjects:function(a){for(var b=0;b<a.length;b++)for(var c=0;c<a[b].length;c++)this.placeSolidObject(a[b][c],b,c,a[b][c].durability)},spawnTreasureChests:function(a){for(var b=0;b<a.length;b++)this.objectMap[a[b].x][a[b].y]=new Treasure(game,a[b].x*TILE_SIZE,a[b].y*TILE_SIZE,"treasureChest"),this.objectMap[a[b].x][a[b].y].setState(a[b].state),this.objectMap[a[b].x][a[b].y].setSize(a[b].playerRequired),this.solidObjectsGroup.add(this.objectMap[a[b].x][a[b].y]),
this.solidObjectsGroup.add(this.objectMap[a[b].x][a[b].y].lootEmitter),this.treasureUIGroup.add(this.objectMap[a[b].x][a[b].y].lockBackground),this.treasureUIGroup.add(this.objectMap[a[b].x][a[b].y].lockCountText),this.treasureUIGroup.add(this.objectMap[a[b].x][a[b].y].lockIcon)},placeSolidObject:function(a,b,c,d){0===a&&(this.objectMap[b][c]=new Tree(game,b*TILE_SIZE,c*TILE_SIZE,"willowTree"),this.objectMap[b][c].setState(d),this.solidObjectsGroup.add(this.objectMap[b][c]))},deleteObjectAt:function(a,
b){this.objectMap[a][b]&&this.objectMap[a][b].destroy()},interactWithChest:function(a,b,c,d,e){if(e=this.objectMap[a][b])1===c&&(d==e.numPlayersRequired?this.playSoundFrom(this.chestLockedSound,a*TILE_SIZE,b*TILE_SIZE):(this.playSoundFrom(this.chestUnlockSound,a*TILE_SIZE,b*TILE_SIZE),e.unlockOnce())),2===c&&1!==e.frame&&(e.open(),this.playSoundFrom(this.chestOpenSound,a*TILE_SIZE,b*TILE_SIZE)),3===c&&0!==e.frame&&(e.frame=0,e.lootEmitter.on=!1,this.playSoundFrom(this.pickupLootSound,a*TILE_SIZE,
b*TILE_SIZE,.3)),4===c&&this.playSoundFrom(this.pickupLootSound,a*TILE_SIZE,b*TILE_SIZE,.3)},cutTree:function(a,b,c){var d=a*TILE_SIZE,e=b*TILE_SIZE;0<c?this.playSoundFrom(this.treeCutSound,d,e,.25):0===c&&(this.playSoundFrom(this.treeDestroyedSound,d,e,.25),this.objectMap[a][b].cutDown())},playSoundFrom:function(a,b,c,d){d=void 0===d?1:d;b=this.getDistance(b,c,this.player.x,this.player.y)/MIN_HEARING_DISTANCE;1<b&&(b=1);a.volume=1===d?1-b:(1-b)*d;0<a.volume&&a.play()},getDistance:function(a,b,c,
d){return Math.sqrt((c-a)*(c-a)+(d-b)*(d-b))}};function InventoryUI(a,b,c,d,e){Phaser.Sprite.call(this,a,b,c,d,e);this.tileName="Grass Sand Stone Water Bridge Forest Snow Desert Ice Cobblestone".split(" ");this.hexRed=16753172;this.hexGray=11842740;this.hexWhite=16777215;this.stringMargin=36;this.countOffsetX=58;this.countOffsetY=39;this.highlightOffsetX=37;this.highlightOffsetY=16;this.numbersOffsetX=52;this.numbersOffsetY=6;this.highlightUI=a.add.sprite(b+this.highlightOffsetX,c+this.highlightOffsetY,"highlightUI");this.itemsText=[];for(d=0;9>
d;d++)this.itemsText[d]=a.add.bitmapText(b+d*this.stringMargin+this.countOffsetX,c+this.countOffsetY,"m5x7","0",21);this.itemsText[3].text="20";this.numbersText=[];for(d=0;9>d;d++)this.numbersText[d]=a.add.bitmapText(b+d*this.stringMargin+this.numbersOffsetX,c+this.numbersOffsetY,"m5x7",d+1+"",21);for(a=0;a<this.numbersText.length;a++)b=a,3<b&&(b=a-1),this.itemsText[b].tint="64"==this.itemsText[b].text?this.hexRed:"0"==this.itemsText[b].text?this.hexGray:this.hexWhite}InventoryUI.prototype=Object.create(Phaser.Sprite.prototype);
InventoryUI.prototype.constructor=InventoryUI;InventoryUI.prototype.updateHighlight=function(a){this.highlightUI.x=this.x+a*this.stringMargin+this.highlightOffsetX};InventoryUI.prototype.updateCountColor=function(){for(var a=0;a<this.numbersText.length;a++){var b=a;3<b&&(b=a-1);this.itemsText[b].tint="64"==this.itemsText[b].text?this.hexRed:"0"==this.itemsText[b].text?this.hexGray:this.hexWhite}};
InventoryUI.prototype.updateDisplay=function(a){for(var b=0;b<a.length;b++)3>=b?this.itemsText[b].text=a[b]:this.itemsText[b-1].text=a[b];this.updateCountColor()};var GAME_WIDTH=640,GAME_HEIGHT=480,game,mainMenuState,gameplayState,controlsState;window.onload=function(){game=new Phaser.Game(GAME_WIDTH,GAME_HEIGHT,Phaser.AUTO);mainMenuState=new MainMenuState(game);gameplayState=new GameplayState(game);controlsState=new ControlsState(game);game.state.add("MainMenuState",mainMenuState);game.state.add("GameplayState",gameplayState);game.state.add("ControlsState",controlsState);game.state.start("MainMenuState")};
window.addEventListener("keydown",function(a){-1<[32,37,38,39,40].indexOf(a.keyCode)&&a.preventDefault()},!1);var MainMenuState=function(a){this.joinTextY=300;this.controlsTextY=360;this.textColor=12545866};
MainMenuState.prototype={init:function(){game.scale.pageAlignHorizontally=!0;game.scale.pageAlignVertically=!0;game.stage.disableVisibilityChange=!0;game.stage.smoothed=!1},preload:function(){game.load.bitmapFont("m5x7","assets/font/m5x7.png","assets/font/m5x7.fnt");game.load.spritesheet("mainMenuBackground","./assets/img/main_menu_art.png");game.load.spritesheet("player","./assets/img/person_spritesheet_large.png",32,32);game.load.spritesheet("treasureChest","./assets/img/treasurechest_spritesheet.png",
32,32);game.load.spritesheet("willowTree","./assets/img/willow_spritesheet.png",32,32);game.load.spritesheet("tileSpritesheet","./assets/img/game_tileset.png",32,32);game.load.image("gameTileset","./assets/img/game_tileset.png",32,32);game.load.image("arrowIcon","./assets/img/arrow.png",32,32);game.load.image("soundIcon","./assets/img/sound.png",64,32);game.load.image("lockIcon","./assets/img/lock.png");game.load.image("lockBackground","./assets/img/chest_icon_box.png");game.load.image("inventoryUI",
"./assets/img/inventory_ui.png",48,128);game.load.image("highlightUI","./assets/img/highlight_ui.png",37,34);game.load.image("pauseBackground","./assets/img/pause_background.png");game.load.image("menuHighlight","./assets/img/menu_highlight.png");game.load.image("zIcon","./assets/img/Z_key_icon.png");game.load.image("eIcon","./assets/img/E_key_icon.png");game.load.image("escIcon","./assets/img/Esc_key_icon.png");game.load.image("spaceIcon","./assets/img/Space_key_icon.png");game.load.image("arrowKeysIcon",
"./assets/img/Arrow_keys_icon.png");game.load.image("raindrop","assets/img/raindrop.png");game.load.spritesheet("snowflakes","assets/img/snowflakes.png",16,16);game.load.image("screenShader","assets/img/screen_shader.png");game.load.audio("placeTileSound",["assets/audio/place_tile.ogg","assets/audio/place_tile.mp3"]);game.load.audio("errorSound",["assets/audio/wrong.ogg","assets/audio/wrong.mp3"]);game.load.audio("abstractSound",["assets/audio/snap01.ogg","assets/audio/snap01.mp3"]);game.load.audio("pickupLootSound",
["assets/audio/pickup_loot01.ogg","assets/audio/pickup_loot01.mp3"]);game.load.audio("chestOpenSound",["assets/audio/creak.ogg","assets/audio/creak.mp3"]);game.load.audio("chestUnlockSound",["assets/audio/unlock.ogg","assets/audio/unlock.mp3"]);game.load.audio("chestLockedSound",["assets/audio/closed_lock.ogg","assets/audio/closed_lock.mp3"]);game.load.audio("treeCutSound",["assets/audio/chop01.ogg","assets/audio/chop01.mp3"]);game.load.audio("treeDestroyedSound",["assets/audio/creak01.ogg","assets/audio/creak01.mp3"]);
game.load.audio("lightRain",["assets/audio/light_rain.ogg","assets/audio/lightRain.mp3"]);game.load.audio("grassFootsteps",["assets/audio/grass_footsteps.ogg","assets/audio/grass_footsteps.mp3"]);game.load.audio("sandFootsteps",["assets/audio/sand_footsteps.ogg","assets/audio/sand_footsteps.mp3"]);game.load.audio("stoneFootsteps",["assets/audio/stone_footsteps.ogg","assets/audio/stone_footsteps.mp3"]);game.load.audio("blipLow",["assets/audio/blip_low.ogg","assets/audio/blip_low.mp3"]);game.load.audio("blipHigh",
["assets/audio/blip_high.ogg","assets/audio/blip_high.mp3"])},create:function(){setTimeout(function(){document.getElementsByTagName("canvas")[0].style.opacity=1},0);this.mainMenuBackground=game.add.sprite(0,0,"mainMenuBackground");this.titleText=game.add.bitmapText(GAME_WIDTH/2,170,"m5x7","Alterrain",64);this.titleText.anchor.setTo(.5);this.joinText=game.add.bitmapText(GAME_WIDTH/2,this.joinTextY,"m5x7","Join Game",48);this.joinText.anchor.setTo(.5);this.controlsText=game.add.bitmapText(GAME_WIDTH/
2,this.controlsTextY,"m5x7","Controls",48);this.controlsText.anchor.setTo(.5);this.menuHighlight=game.add.sprite(GAME_WIDTH/2,this.joinTextY-8,"menuHighlight");this.menuHighlight.anchor.setTo(.5);this.menuChoice=0;this.zIcon=game.add.sprite(this.menuHighlight.x-this.menuHighlight.width/2-36,this.menuHighlight.y-this.menuHighlight.height/2+2,"zIcon");this.blipHigh=game.add.audio("blipHigh");this.blipHigh.volume=.25;this.blipLow=game.add.audio("blipLow");this.blipLow.volume=.25},update:function(){game.input.keyboard.justPressed(Phaser.Keyboard.UP)&&
1===this.menuChoice&&(this.menuChoice=0,this.menuHighlight.y=this.joinTextY-8,this.zIcon.y=this.menuHighlight.y-this.menuHighlight.height/2+2,this.blipLow.play());game.input.keyboard.justPressed(Phaser.Keyboard.DOWN)&&0===this.menuChoice&&(this.menuChoice=1,this.menuHighlight.y=this.controlsTextY-8,this.zIcon.y=this.menuHighlight.y-this.menuHighlight.height/2+2,this.blipLow.play());if(game.input.keyboard.justPressed(Phaser.Keyboard.Z)||game.input.keyboard.justPressed(Phaser.Keyboard.SPACEBAR))0===
this.menuChoice?(this.blipHigh.play(),game.state.start("GameplayState")):1===this.menuChoice&&(this.blipHigh.play(),game.state.start("ControlsState"))}};function PauseUI(a,b,c){this.game=a;this.x=b||0;this.y=c||0;this.paused=!0;this.pauseBackground=a.add.sprite(b+GAME_WIDTH/2,c+190,"pauseBackground");this.pauseBackground.anchor.setTo(.5);this.pauseBackground.scale.setTo(2);this.promptText=a.add.bitmapText(b+GAME_WIDTH/2,c+170,"m5x7","Are you sure you want to quit?",32);this.promptText.anchor.setTo(.5);this.choiceText=a.add.bitmapText(b+GAME_WIDTH/2,c+220,"m5x7","Y to confirm, Esc to cancel",32);this.choiceText.anchor.setTo(.5)}
PauseUI.prototype.show=function(){this.paused=!0;this.promptText.alpha=1;this.choiceText.alpha=1;this.pauseBackground.alpha=1};PauseUI.prototype.hide=function(){this.paused=!1;this.promptText.alpha=0;this.choiceText.alpha=0;this.pauseBackground.alpha=0};PauseUI.prototype.destroy=function(){this.promptText.destroy();this.choiceText.destroy();this.pauseBackground.destroy()};function Player(a,b,c,d,e){Phaser.Sprite.call(this,a,b,c,d,e);this.canMove=!0;this.moveDuration=10;this.nextPos={x:0,y:0};this.moveTimer=a.time.create(!1);this.moveSpeed=4;this.facing=FACING_DOWN;this.arrowIconOffsetY=-32;this.arrowIcon=null;this.soundIconDuration=500;this.soundIconTimer=a.time.create(!1);this.canMakeSound=!0;this.soundIconOffsetY=-8;this.soundIcon=a.add.sprite(this.x,this.y+this.soundIconOffsetY,"soundIcon");this.soundIcon.anchor.x=.25;this.soundIcon.alpha=0}Player.prototype=Object.create(Phaser.Sprite.prototype);
Player.prototype.constructor=Player;Player.prototype.update=function(){};Player.prototype.bringToTop=function(){game.world.bringToTop(this);game.world.bringToTop(this.soundIcon);this.arrowIcon&&game.world.bringToTop(this.arrowIcon)};Player.prototype.enableArrowIcon=function(){this.arrowIcon=game.add.sprite(this.x,this.y+this.arrowIconOffsetY,"arrowIcon")};Player.prototype.startSoundTimer=function(){this.toggleSoundIcon();this.soundIconTimer.add(this.soundIconDuration,this.toggleSoundIcon,this);this.soundIconTimer.start()};
Player.prototype.toggleSoundIcon=function(){0===this.soundIcon.alpha?(this.soundIcon.alpha=1,this.canMakeSound=!1):1===this.soundIcon.alpha&&(this.soundIcon.alpha=0,this.canMakeSound=!0)};Player.prototype.updateIconPositions=function(a,b){this.arrowIcon&&(this.arrowIcon.x=a,this.arrowIcon.y=b+this.arrowIconOffsetY);this.soundIcon.x=a;this.soundIcon.y=b+this.soundIconOffsetY};Player.prototype.ableToMove=function(){return this.canMove};
Player.prototype.stepTo=function(){this.x<this.nextPos.x?this.x+=this.moveSpeed:this.x>this.nextPos.x?this.x-=this.moveSpeed:this.y<this.nextPos.y?this.y+=this.moveSpeed:this.y>this.nextPos.y&&(this.y-=this.moveSpeed);this.updateIconPositions(this.x,this.y);this.nextPos.x===this.x&&this.nextPos.y===this.y&&(this.canMove=!0)};
Player.prototype.setDirection=function(a){this.facing=a;switch(a){case FACING_DOWN:this.frame=0;break;case FACING_LEFT:this.frame=3;break;case FACING_RIGHT:this.frame=1;break;case FACING_UP:this.frame=2;break;default:console.log("should not happen")}};
Player.prototype.moveTo=function(a,b){this.canMove&&(this.canMove=!1,this.nextPos={x:a,y:b},this.x<this.nextPos.x?(this.facing=FACING_RIGHT,this.frame=1):this.x>this.nextPos.x?(this.facing=FACING_LEFT,this.frame=3):this.y<this.nextPos.y?(this.facing=FACING_DOWN,this.frame=0):this.y>this.nextPos.y&&(this.facing=FACING_UP,this.frame=2))};function Treasure(a,b,c,d,e){Phaser.Sprite.call(this,a,b,c,d,e);this.frame=this.numPlayersRequired=1;this.lockCountText=a.add.bitmapText(b+2,c-12,"m5x7","1x",24);this.lockCountText.tint=16762917;this.lockIcon=a.add.sprite(b+22,c-12,"lockIcon");this.lockBackground=a.add.sprite(b,c-14,"lockBackground");this.lootEmitter=a.add.emitter(b+16,c+14);this.lootEmitter.makeParticles("tileSpritesheet",[0,1,2,5,6,7,8],16);this.lootEmitter.gravity=128;this.lootEmitter.setXSpeed(-48,48);this.lootEmitter.setYSpeed(-64,
-32);this.lootEmitter.setScale(.25,.25,.25,.25)}Treasure.prototype=Object.create(Phaser.Sprite.prototype);Treasure.prototype.constructor=Tree;Treasure.prototype.setSize=function(a){0<a&&(this.numPlayersRequired=a,this.frame=2,this.lockCountText.text=a+"x")};Treasure.prototype.update=function(){this.lockCountText.text!=this.numPlayersRequired+"x"&&(this.lockCountText.text=this.numPlayersRequired+"x")};
Treasure.prototype.setState=function(a){if(3===a)this.frame=0,this.lootEmitter.on=!1,this.lockCountText.destroy(),this.lockIcon.destroy(),this.lockBackground.destroy();else if(2===a)this.frame=1,this.lootEmitter.start(!1,500,250),this.lockCountText.destroy(),this.lockIcon.destroy(),this.lockBackground.destroy();else if(1===a||0===a)this.frame=2};Treasure.prototype.setHidden=function(a){this.alpha=(this.hidden=a)?0:1};
Treasure.prototype.open=function(){this.frame=1;this.lootEmitter.start(!1,500,250);this.lockCountText.destroy();this.lockIcon.destroy();this.lockBackground.destroy()};Treasure.prototype.digUp=function(){this.setHidden(!1)};Treasure.prototype.unlockOnce=function(){this.numPlayersRequired--;this.lockCountText.text=this.numPlayersRequired+"x"};function Tree(a,b,c,d,e){Phaser.Sprite.call(this,a,b,c,d,e)}Tree.prototype=Object.create(Phaser.Sprite.prototype);Tree.prototype.constructor=Tree;Tree.prototype.cutDown=function(){this.frame=1};Tree.prototype.setState=function(a){this.frame=0>=a?1:0};
}).call(this)
